generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model booking {
  booking_id   Int             @id @default(autoincrement())
  total_price  Decimal         @db.Decimal(8, 2)
  status       booking_status? @default(Pending)
  booking_date DateTime?       @default(now()) @db.Timestamp(6)
  customer_id  Int?
  showtime_id  Int?
  customer     customer?       @relation(fields: [customer_id], references: [customer_id], onDelete: NoAction, onUpdate: NoAction)
  showtime     showtime?       @relation(fields: [showtime_id], references: [showtime_id], onDelete: NoAction, onUpdate: NoAction)
  booking_seat booking_seat[]
}

model booking_seat {
  showtime_id Int
  seat_id     Int
  booking_id  Int?
  tariff_id   Int?
  final_price Decimal? @db.Decimal(7, 2)
  booking     booking? @relation(fields: [booking_id], references: [booking_id], onDelete: NoAction, onUpdate: NoAction)
  seat        seat     @relation(fields: [seat_id], references: [seat_id], onDelete: NoAction, onUpdate: NoAction)
  showtime    showtime @relation(fields: [showtime_id], references: [showtime_id], onDelete: NoAction, onUpdate: NoAction)
  tariff      tariff?  @relation(fields: [tariff_id], references: [tariff_id], onDelete: NoAction, onUpdate: NoAction)

  @@id([showtime_id, seat_id])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model cinema_hall {
  hall_id     Int        @id @default(autoincrement())
  hall_number Int        @unique
  capacity    Int
  seat        seat[]
  showtime    showtime[]
}

model customer {
  customer_id Int       @id @default(autoincrement())
  first_name  String    @db.VarChar(100)
  last_name   String    @db.VarChar(100)
  email       String    @unique @db.VarChar(255)
  phone       String?   @db.VarChar(20)
  booking     booking[]
}

model genre {
  genre_id    Int           @id @default(autoincrement())
  name        String        @unique @db.VarChar(30)
  movie_genre movie_genre[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model movie {
  movie_id     Int           @id @default(autoincrement())
  title        String        @unique @db.VarChar(255)
  age_limit    Int
  duration_min Int
  release_year Int
  description  String?
  movie_genre  movie_genre[]
  showtime     showtime[]
}

model movie_genre {
  movie_id Int
  genre_id Int
  genre    genre @relation(fields: [genre_id], references: [genre_id], onDelete: NoAction, onUpdate: NoAction)
  movie    movie @relation(fields: [movie_id], references: [movie_id], onDelete: NoAction, onUpdate: NoAction)

  @@id([movie_id, genre_id])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model seat {
  seat_id      Int            @id @default(autoincrement())
  row_number   Int
  seat_number  Int
  seat_type    seat_type
  base_price   Decimal        @db.Decimal(6, 2)
  hall_id      Int?
  booking_seat booking_seat[]
  cinema_hall  cinema_hall?   @relation(fields: [hall_id], references: [hall_id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([hall_id, row_number, seat_number])
}

model showtime {
  showtime_id  Int            @id @default(autoincrement())
  show_date    DateTime       @db.Date
  show_time    DateTime       @db.Time(6)
  movie_id     Int?
  hall_id      Int?
  booking      booking[]
  booking_seat booking_seat[]
  cinema_hall  cinema_hall?   @relation(fields: [hall_id], references: [hall_id], onDelete: NoAction, onUpdate: NoAction)
  movie        movie?         @relation(fields: [movie_id], references: [movie_id], onDelete: NoAction, onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model tariff {
  tariff_id        Int            @id @default(autoincrement())
  name             String         @db.VarChar(30)
  start_time       DateTime       @db.Time(6)
  end_time         DateTime       @db.Time(6)
  price_multiplier Decimal        @db.Decimal(3, 2)
  booking_seat     booking_seat[]
}

enum booking_status {
  Pending
  Confirmed
  Cancelled
}

enum seat_type {
  standard
  VIP
}
